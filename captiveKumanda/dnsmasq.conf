# dnsmasq configuration for DHCP and DNS
# Usage: sudo dnsmasq -C dnsmasq.conf

# Interface to listen on
interface=wlan0

# CRITICAL: Only listen on hotspot IP, not localhost
# This prevents dnsmasq from intercepting system DNS queries
listen-address=192.168.4.1

# DHCP settings
dhcp-range=192.168.4.2,192.168.4.20,12h

# Set the gateway (this device)
dhcp-option=3,192.168.4.1

# Set DNS server (this device - for captive portal redirect)
dhcp-option=6,192.168.4.1

# ==========================================
# LOCALHOST EXCEPTION FIX
# ==========================================
# Preserve localhost resolution for system processes
# This prevents the PHP kiosk from timing out on local resources
address=/localhost/127.0.0.1
address=/localhost.localdomain/127.0.0.1
# ==========================================

# ==========================================
# GAME SHORT-CIRCUIT FIX
# ==========================================
# Direct these domains to LOCALHOST (PHP Server)
# This overrides the wildcard catch-all below
address=/fungames.com/127.0.0.1
address=/www.fungames.com/127.0.0.1
# ==========================================

# Redirect ALL OTHER DNS queries to this device (captive portal)
address=/#/192.168.4.1

# Don't use /etc/resolv.conf
no-resolv

# Bind to interface only
bind-interfaces

# Log DHCP transactions
log-dhcp

# Don't read /etc/hosts
no-hosts
